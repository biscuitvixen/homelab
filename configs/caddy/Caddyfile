{
	# Optional: quieten logs / set contact email
	# email you@example.com
	admin off
	encode zstd gzip
}

# === a tiny reusable snippet for internal TLS ===
(tls_internal) {
	tls internal
}

# === Reverse proxies ===

adguard.lan {
	import tls_internal
	reverse_proxy adguard:80
}

home.lan {
  import tls_internal
	reverse_proxy https://192.168.0.12:8123 {
    transport http {
      tls_insecure_skip_verify
    }
    header_up Host {host}          # preserve original host header
    header_up X-Forwarded-For {remote}
    header_up X-Forwarded-Proto {scheme}
  }
}

truenas.lan {
  import tls_internal
	reverse_proxy https://192.168.0.11 {
    transport http {
      tls_insecure_skip_verify
    }
    header_up Host {host}
    header_up X-Forwarded-For {remote}
    header_up X-Forwarded-Proto {scheme}
  }
}

pve.lan {
  import tls_internal
  reverse_proxy https://192.168.0.10:8006 {
    transport http {
      tls_insecure_skip_verify
    }
  }
}

# A landing page at https://lab.lan/
lab.lan {
	import tls_internal
	@root path /
	handle @root {
		respond <<-EOF
		<!doctype html>
		<html>
		  <head><meta charset="utf-8"><title>Homelab</title></head>
		  <body style="font-family: system-ui; max-width: 800px; margin: 3rem auto;">
		    <h1>Homelab</h1>
		    <ul>
		      <li><a href="https://adguard.lan">AdGuard</a></li>
		      <li><a href="https://home.lan">Home Assistant</a></li>
		      <li><a href="https://portainer.lan">Portainer</a></li>
		      <li><a href="https://truenas.lan">TrueNAS</a></li>
		    </ul>
		  </body>
		</html>
		-EOF
	}
}
