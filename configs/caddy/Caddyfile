{
	# Optional: quieten logs / set contact email
	# email you@example.com
	admin off
}

# === a tiny reusable snippet for internal TLS ===
(tls_internal) {
	tls internal
}

# === Reverse proxies ===

adguard.lan {
	import tls_internal
	reverse_proxy adguard:80
}

home.lan {
  import tls_internal
	reverse_proxy http://192.168.0.12:8123
}

truenas.lan {
  import tls_internal
	reverse_proxy https://192.168.0.11 {
    transport http {
      tls_insecure_skip_verify
    }
  }
}

pve.lan {
  import tls_internal
  reverse_proxy https://192.168.0.10:8006 {
    transport http {
      tls_insecure_skip_verify
    }
  }
}

# A landing page at https://lab.lan/
lab.lan {
	import tls_internal
	
	root * /web/lab.lan
	file_server

	# Ensure JSON files are served with correct MIME type
    @json path *.json
    header @json Content-Type application/json

	# Serve files if they exist, otherwise serve index.html for SPA routing
	try_files {path} /index.html

  # --- Probe endpoints (same-origin) ---
  handle_path /probe/adguard* {
    reverse_proxy http://adguard:80
  }

  handle_path /probe/home* {
    reverse_proxy http://192.168.0.12:8123
  }

  handle_path /probe/truenas* {
    reverse_proxy https://192.168.0.11 {
      transport http { tls_insecure_skip_verify }
    }
  }

  handle_path /probe/pve* {
    reverse_proxy https://192.168.0.10:8006 {
      transport http { tls_insecure_skip_verify }
    }
  }
}
