services:
  # samba:
  #   extends:
  #     file: ./services/samba.yml
  #     service: samba
  #   profiles: ["serv"]
  #   user: "1001:3001"

  tailscale-server:
    extends:
      file: ./services/tailscale.yml
      service: tailscale-server
    profiles: ["serv"]

  tailscale-pi:
    extends:
      file: ./services/tailscale.yml
      service: tailscale-pi
    profiles: ["pi"]

  unbound:
    extends:
      file: ./services/unbound.yml
      service: unbound
    profiles: ["serv", "dns"]
    networks:
      - homelab_network

  adguard:
    extends:
      file: ./services/adguard.yml
      service: adguard
    depends_on:
      unbound:
        condition: service_healthy
    profiles: ["serv", "dns"]
    networks:
      - homelab_network

  caddy:
    extends:
      file: ./services/caddy.yml
      service: caddy
    depends_on:
      adguard:
        condition: service_healthy
      unbound:
        condition: service_healthy
    profiles: ["serv", "dns"]
    networks:
      - homelab_network

  homeassistant:
    extends:
      file: ./services/homeassistant.yml
      service: homeassistant
    depends_on:
      - mosquitto
    profiles: ["serv"]
    networks:
      - homelab_network

  mosquitto:
    extends:
      file: ./services/mosquitto.yml
      service: mosquitto
    profiles: ["serv"]
    networks:
      - homelab_network

  watchtower:
    extends:
      file: ./services/watchtower.yml
      service: watchtower
    profiles: ["serv"]
    networks:
      - homelab_network

  portainer:
    extends:
      file: ./services/portainer.yml
      service: portainer
    profiles: ["serv"]
    networks:
      - homelab_network

# Shared network for service communication
networks:
  homelab_network:
    driver: bridge
    name: homelab_network

volumes:
  # Ephemeral volume for Caddy's config persistence
  caddy_config: