services:
  samba:
    image: dperson/samba:latest
    container_name: samba
    restart: unless-stopped
    ports:
      - "139:139"
      - "445:445"
    volumes:
      - ${NETWORK_STORAGE_PATH}:/mount 
    environment:
      - USERID=${PUID}
      - GROUPID=${PGID}
    command: >
      -s "storage;/mount;yes;no;no;${SAMBA_USER}"
      -u "${SAMBA_USER};${SAMBA_PASSWORD}"
    healthcheck:
      test: ["CMD-SHELL", "smbclient -L localhost -N || exit 1"]
      interval: ${HEALTHCHECK_INTERVAL:-30s}
      timeout: ${HEALTHCHECK_TIMEOUT:-10s}
      retries: ${HEALTHCHECK_RETRIES:-3}
      start_period: ${HEALTHCHECK_START_PERIOD:-30s}
    networks:
      - asteria_network