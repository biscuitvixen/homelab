services:
  caddy:
    image: caddy:latest
    container_name: caddy
    ports:
      - "80:80"     # publish HTTP on the LXC host
      - "443:443"   # publish HTTPS on the LXC host
    volumes:
      - ../configs/caddy/Caddyfile:/etc/caddy/Caddyfile:ro  # Config file
      - ${BASE}/appdata/caddy/data:/data                    # Caddy's cert store (internal CA, certs, OCSP cache)
      - caddy_config:/config                                # Admin API state (optional but nice to persist)
    healthcheck:
      test: ["CMD", "caddy", "validate", "--config", "/etc/caddy/Caddyfile"]
      interval: 30s
      timeout: 5s
      retries: 5
      start_period: 20s